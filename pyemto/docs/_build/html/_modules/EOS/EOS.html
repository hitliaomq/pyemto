

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>EOS.EOS &mdash; pyEMTO 0.9.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="pyEMTO 0.9.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pyEMTO
          

          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code.html">pyEMTO Code Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation.html">pyEMTO presentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyEMTO</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>EOS.EOS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for EOS.EOS</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Wed Dec  9 10:51:00 2014</span>

<span class="sd">@author: Matti Ropo</span>
<span class="sd">@author: Henrik Levämäki</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">leastsq</span>


<span class="k">def</span> <span class="nf">_general_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This part comes from:</span>

<span class="sd">    http://projects.scipy.org/scipy/browser/trunk/scipy/optimize/minpack.py</span>

<span class="sd">    :param params:</span>
<span class="sd">    :type params:</span>
<span class="sd">    :param xdata:</span>
<span class="sd">    :type xdata:</span>
<span class="sd">    :param ydata:</span>
<span class="sd">    :type ydata:</span>
<span class="sd">    :param function:</span>
<span class="sd">    :type function:</span>
<span class="sd">    :returns:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span> <span class="o">-</span> <span class="n">ydata</span>


<div class="viewcode-block" id="curve_fit"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.curve_fit">[docs]</a><span class="k">def</span> <span class="nf">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fits an arbitraty function to data (x,y).</span>

<span class="sd">    This part comes from:</span>
<span class="sd">    http://projects.scipy.org/scipy/browser/trunk/scipy/optimize/minpack.py</span>

<span class="sd">    :param f:</span>
<span class="sd">    :type f:</span>
<span class="sd">    :param x:</span>
<span class="sd">    :type x:</span>
<span class="sd">    :param y:</span>
<span class="sd">    :type y:</span>
<span class="sd">    :param p0:</span>
<span class="sd">    :type p0:</span>
<span class="sd">    :returns:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">func</span> <span class="o">=</span> <span class="n">_general_function</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1.0e-15</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Optimal parameters not found: &quot;</span> <span class="o">+</span> <span class="n">mesg</span><span class="p">)</span>
    <span class="c1"># end of this part</span>
    <span class="k">return</span> <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">ier</span></div>


<div class="viewcode-block" id="EOS"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS">[docs]</a><span class="k">class</span> <span class="nc">EOS</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Fit equation of state for bulk systems.</span>

<span class="sd">    The following equations are available:</span>

<span class="sd">    ================ ==============================================================</span>
<span class="sd">    morse            PRB 37, 790 (1988)</span>
<span class="sd">    sjeos            PRB 63, 224115 (2001)</span>
<span class="sd">    taylor           A third order Taylor series expansion about the minimum volume</span>
<span class="sd">    murnaghan        PRB 28, 5480 (1983)</span>
<span class="sd">    birch            Intermetallic compounds: Principles and Practice,</span>
<span class="sd">                     Vol I: Principles. pages 195-210</span>
<span class="sd">    birchmurnaghan   PRB 70, 224107</span>
<span class="sd">    pouriertarantola PRB 70, 224107</span>
<span class="sd">    vinet            PRB 70, 224107</span>
<span class="sd">    antonschmidt     Intermetallics 11, 23-32 (2003)</span>
<span class="sd">    oldpoly          A third order polynomial fit (alternative implementation)</span>
<span class="sd">    ================ ==============================================================</span>

<span class="sd">    Usage::</span>

<span class="sd">       eos = EquationOfState(volumes, energies, eos=&#39;murnaghan&#39;)</span>
<span class="sd">       v0, e0, B = eos.fit()</span>
<span class="sd">       eos.plot()</span>

<span class="sd">    :param name:</span>
<span class="sd">    :type name:</span>
<span class="sd">    :param xc:  (Default value = &#39;PBE&#39;)</span>
<span class="sd">    :type xc:</span>
<span class="sd">    :param method:  (Default value = &#39;morse&#39;)</span>
<span class="sd">    :type method:</span>
<span class="sd">    :param units:  (Default value = &#39;bohr&#39;)</span>
<span class="sd">    :type units:</span>
<span class="sd">    :returns:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="s1">&#39;PBE&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;morse&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;bohr&#39;</span><span class="p">,</span> <span class="n">warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relerror</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redchi</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nq</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sws0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grun</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grun_g_factor</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span> <span class="o">=</span> <span class="mf">0.52917721092</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span> <span class="o">=</span> <span class="mf">13.605692533</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ev2gpa</span> <span class="o">=</span> <span class="mf">160.21773</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_infodict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitted_ens</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="n">warnings</span>

<div class="viewcode-block" id="EOS.vol2wsrad"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.vol2wsrad">[docs]</a>    <span class="k">def</span> <span class="nf">vol2wsrad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">V</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="EOS.wsrad2vol"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.wsrad2vol">[docs]</a>    <span class="k">def</span> <span class="nf">wsrad2vol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">WSrad</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param WSrad:</span>
<span class="sd">        :type WSrad:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">WSrad</span><span class="o">**</span><span class="mi">3</span></div>

<div class="viewcode-block" id="EOS.angstrom2bohr"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.angstrom2bohr">[docs]</a>    <span class="k">def</span> <span class="nf">angstrom2bohr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">V</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.52917721092</span></div>

<div class="viewcode-block" id="EOS.bohr2angstrom"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.bohr2angstrom">[docs]</a>    <span class="k">def</span> <span class="nf">bohr2angstrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">WSrad</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param WSrad:</span>
<span class="sd">        :type WSrad:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">WSrad</span> <span class="o">*</span> <span class="mf">0.52917721092</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span></div>

<div class="viewcode-block" id="EOS.morse"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.morse">[docs]</a>    <span class="k">def</span> <span class="nf">morse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sws</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">l0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param w:</span>
<span class="sd">        :type w:</span>
<span class="sd">        :param a0:</span>
<span class="sd">        :type a0:</span>
<span class="sd">        :param b0:</span>
<span class="sd">        :type b0:</span>
<span class="sd">        :param c0:</span>
<span class="sd">        :type c0:</span>
<span class="sd">        :param l0:</span>
<span class="sd">        :type l0:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">l0</span> <span class="o">*</span> <span class="n">sws</span><span class="p">)</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l0</span> <span class="o">*</span> <span class="n">sws</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.taylor"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.taylor">[docs]</a>    <span class="k">def</span> <span class="nf">taylor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Taylor Expansion up to 3rd order about V0</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param E0:</span>
<span class="sd">        :type E0:</span>
<span class="sd">        :param beta:</span>
<span class="sd">        :type beta:</span>
<span class="sd">        :param alpha:</span>
<span class="sd">        :type alpha:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :type V0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">E0</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">V</span> <span class="o">-</span> <span class="n">V0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">V0</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">6.</span> <span class="o">*</span> <span class="p">(</span><span class="n">V</span> <span class="o">-</span> <span class="n">V0</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="n">V0</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.murnaghan"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.murnaghan">[docs]</a>    <span class="k">def</span> <span class="nf">murnaghan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;From PRB 28,5480 (1983)</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param E0:</span>
<span class="sd">        :type E0:</span>
<span class="sd">        :param B0:</span>
<span class="sd">        :type B0:</span>
<span class="sd">        :param BP:</span>
<span class="sd">        :type BP:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :type V0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">E0</span> <span class="o">+</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">V</span> <span class="o">/</span> <span class="n">BP</span> <span class="o">*</span> \
            <span class="p">(((</span><span class="n">V0</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span><span class="o">**</span><span class="n">BP</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">BP</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">V0</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">/</span> <span class="p">(</span><span class="n">BP</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.birch"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.birch">[docs]</a>    <span class="k">def</span> <span class="nf">birch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;From Intermetallic compounds: Principles and Practice, Vol. I: Principles</span>
<span class="sd">        Chapter 9 pages 195-210 by M. Mehl. B. Klein, D. Papaconstantopoulos</span>
<span class="sd">        paper downloaded from Web</span>

<span class="sd">        case where n=0</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param E0:</span>
<span class="sd">        :type E0:</span>
<span class="sd">        :param B0:</span>
<span class="sd">        :type B0:</span>
<span class="sd">        :param BP:</span>
<span class="sd">        :type BP:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :type V0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="n">E0</span> <span class="o">+</span> <span class="mf">9.0</span> <span class="o">/</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">V0</span> <span class="o">*</span> <span class="p">((</span><span class="n">V0</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
             <span class="mf">9.0</span> <span class="o">/</span> <span class="mf">16.0</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">V0</span> <span class="o">*</span> <span class="p">(</span><span class="n">BP</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">V0</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.birchmurnaghan"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.birchmurnaghan">[docs]</a>    <span class="k">def</span> <span class="nf">birchmurnaghan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        BirchMurnaghan equation from PRB 70, 224107</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param E0:</span>
<span class="sd">        :type E0:</span>
<span class="sd">        :param B0:</span>
<span class="sd">        :type B0:</span>
<span class="sd">        :param BP:</span>
<span class="sd">        :type BP:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :type V0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="n">V0</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">E0</span> <span class="o">+</span> <span class="mf">9.</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">V0</span> <span class="o">/</span> <span class="mf">16.</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">+</span> <span class="n">BP</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4.</span> <span class="o">*</span> <span class="n">eta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.pouriertarantola"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.pouriertarantola">[docs]</a>    <span class="k">def</span> <span class="nf">pouriertarantola</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pourier-Tarantola equation from PRB 70, 224107</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param E0:</span>
<span class="sd">        :type E0:</span>
<span class="sd">        :param B0:</span>
<span class="sd">        :type B0:</span>
<span class="sd">        :param BP:</span>
<span class="sd">        :type BP:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :type V0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span> <span class="o">/</span> <span class="n">V0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>
        <span class="n">squiggle</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">E0</span> <span class="o">+</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">V0</span> <span class="o">*</span> <span class="n">squiggle</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">6.</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">+</span> <span class="n">squiggle</span> <span class="o">*</span> <span class="p">(</span><span class="n">BP</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.vinet"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.vinet">[docs]</a>    <span class="k">def</span> <span class="nf">vinet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vinet equation from PRB 70, 224107</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param E0:</span>
<span class="sd">        :type E0:</span>
<span class="sd">        :param B0:</span>
<span class="sd">        :type B0:</span>
<span class="sd">        :param BP:</span>
<span class="sd">        :type BP:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :type V0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span> <span class="o">/</span> <span class="n">V0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span>

        <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="n">E0</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">V0</span> <span class="o">/</span> <span class="p">(</span><span class="n">BP</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mf">2.</span> <span class="o">-</span> <span class="p">(</span><span class="mf">5.</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">BP</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span> <span class="o">*</span> <span class="p">(</span><span class="n">BP</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.antonschmidt"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.antonschmidt">[docs]</a>    <span class="k">def</span> <span class="nf">antonschmidt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Einf</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;From Intermetallics 11, 23-32 (2003)</span>

<span class="sd">        Einf should be E_infinity, i.e. infinite separation, but</span>
<span class="sd">        according to the paper it does not provide a good estimate</span>
<span class="sd">        of the cohesive energy. They derive this equation from an</span>
<span class="sd">        empirical formula for the volume dependence of pressure,</span>

<span class="sd">        E(vol) = E_inf + int(P dV) from V=vol to V=infinity</span>

<span class="sd">        but the equation breaks down at large volumes, so E_inf</span>
<span class="sd">        is not that meaningful</span>

<span class="sd">        n should be about -2 according to the paper.</span>

<span class="sd">        I find this equation does not fit volumetric data as well</span>
<span class="sd">        as the other equtions do.</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param Einf:</span>
<span class="sd">        :type Einf:</span>
<span class="sd">        :param B:</span>
<span class="sd">        :type B:</span>
<span class="sd">        :param n:</span>
<span class="sd">        :type n:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :type V0:</span>
<span class="sd">        :returns: Energy</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">B</span> <span class="o">*</span> <span class="n">V0</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">V</span> <span class="o">/</span> <span class="n">V0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">V</span> <span class="o">/</span> <span class="n">V0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)))</span> <span class="o">+</span> <span class="n">Einf</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.oldpoly"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.oldpoly">[docs]</a>    <span class="k">def</span> <span class="nf">oldpoly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;polynomial fit, 3rd order</span>

<span class="sd">        :param V:</span>
<span class="sd">        :type V:</span>
<span class="sd">        :param c0:</span>
<span class="sd">        :type c0:</span>
<span class="sd">        :param c1:</span>
<span class="sd">        :type c1:</span>
<span class="sd">        :param c2:</span>
<span class="sd">        :type c2:</span>
<span class="sd">        :param c3:</span>
<span class="sd">        :type c3:</span>
<span class="sd">        :returns: Energy</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">c0</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">V</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">V</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.parabola"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.parabola">[docs]</a>    <span class="k">def</span> <span class="nf">parabola</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parabola polynomial function</span>

<span class="sd">        This function is used to fit the data to get good guesses for</span>
<span class="sd">        the equation of state fits.</span>

<span class="sd">        A 4th order polynomial fit to get good guesses for</span>
<span class="sd">        was not a good idea because for noisy data the fit is too wiggly</span>
<span class="sd">        2nd order seems to be sufficient, and guarentees a single minimum.</span>

<span class="sd">        :param x:</span>
<span class="sd">        :type x:</span>
<span class="sd">        :param a:</span>
<span class="sd">        :type a:</span>
<span class="sd">        :param b:</span>
<span class="sd">        :type b:</span>
<span class="sd">        :param c:</span>
<span class="sd">        :type c:</span>
<span class="sd">        :returns: Energy</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span></div>

<div class="viewcode-block" id="EOS.sjeos"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.sjeos">[docs]</a>    <span class="k">def</span> <span class="nf">sjeos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stabilized jellium (SJEOS) fitting function from</span>
<span class="sd">        PRB 63, 224115 (2001).</span>

<span class="sd">        Note: EOS parameters here differ from the PRB definitions</span>
<span class="sd">              by having V0 being included in them.</span>
<span class="sd">              a(PRB) = a/V0</span>
<span class="sd">              b(PRB) = b/V0**(2/3)</span>
<span class="sd">              c(PRB) = c/V0**(1/3)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">V</span> <span class="o">+</span> <span class="n">b</span><span class="o">/</span><span class="n">V</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">/</span><span class="n">V</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span></div>


<div class="viewcode-block" id="EOS.predicted"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.predicted">[docs]</a>    <span class="k">def</span> <span class="nf">predicted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the EOS function using the calc. EOS params.</span>

<span class="sd">        :returns: EOS function</span>
<span class="sd">        :rtype: func</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
            <span class="n">vol_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sws</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vol_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>
        <span class="n">fity</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">))(</span>
            <span class="n">vol_arg</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],)</span>
        <span class="k">return</span> <span class="n">fity</span></div>


<div class="viewcode-block" id="EOS.compute_initial_guess"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.compute_initial_guess">[docs]</a>    <span class="k">def</span> <span class="nf">compute_initial_guess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates initial guessess for the fitting parameters.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;sjeos&#39;</span><span class="p">:</span>
            <span class="c1"># SJEOS fitting routine needs no initial guessess</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">parabola_parameters</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="n">infodict0</span><span class="p">,</span> <span class="n">mesg0</span><span class="p">,</span> <span class="n">ier0</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parabola</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>

            <span class="c1"># Here I just make sure the minimum is bracketed by the volumes.</span>
            <span class="c1"># this if for the solver.</span>
            <span class="n">minvol</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
            <span class="n">maxvol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

            <span class="c1"># the minimum of the parabola is at dE/dV = 0, or 2*c V +b =0</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">parabola_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">parabola_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">parabola_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">parabola_vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">c</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">minvol</span> <span class="o">&lt;</span> <span class="n">parabola_vmin</span> <span class="ow">and</span> <span class="n">parabola_vmin</span> <span class="o">&lt;</span> <span class="n">maxvol</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EOS.compute_initial_guess(): Warning the minimum volume of a fitted&#39;</span> <span class="o">+</span>\
                          <span class="s1">&#39; parabola is not in your volumes.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
                          <span class="s1">&#39;                             You may not have a minimum in your dataset.&#39;</span><span class="p">)</span>

            <span class="c1"># evaluate the parabola at the minimum to estimate the groundstate</span>
            <span class="c1"># energy</span>
            <span class="n">E0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parabola</span><span class="p">(</span><span class="n">parabola_vmin</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

            <span class="c1"># estimate the bulk modulus from Vo*E&#39;&#39;,  E&#39;&#39; = 2*c</span>
            <span class="n">B0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">parabola_vmin</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;antonschmidt&#39;</span><span class="p">:</span>
                <span class="n">BP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">BP</span> <span class="o">=</span> <span class="mi">4</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
                <span class="n">B0</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span><span class="o">**</span><span class="mi">3</span>
                <span class="n">w0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol2wsrad</span><span class="p">(</span><span class="n">parabola_vmin</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span>
                <span class="c1">#l0 = 2.0 * (2.0 - 1.0 / 3.0) / w0</span>
                <span class="n">l0</span> <span class="o">=</span> <span class="p">(</span><span class="n">BP</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">w0</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">l0</span> <span class="o">*</span> <span class="n">w0</span><span class="p">)</span>
                <span class="n">c0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">6.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">B0</span> <span class="o">/</span> <span class="p">(</span><span class="n">x0</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">l0</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">b0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">x0</span>
                <span class="n">a0</span> <span class="o">=</span> <span class="n">E0</span> <span class="o">-</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">x0</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">l0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">E0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">BP</span><span class="p">,</span> <span class="n">parabola_vmin</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">initial_guess</span></div>


<div class="viewcode-block" id="EOS.compute_eos_fit"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.compute_eos_fit">[docs]</a>    <span class="k">def</span> <span class="nf">compute_eos_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs the least-squares curve fitting for the chosen EOS function.</span>
<span class="sd">        Ground state quantities are returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;sjeos&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">**-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
            <span class="n">fit0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">)</span>
            <span class="n">fit1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">fit0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">fit2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">fit1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">fit1</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fit2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="n">t</span><span class="o">**-</span><span class="mi">3</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;SJEOS: No minimum!&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sws0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol2wsrad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">=</span> <span class="n">fit0</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">=</span> <span class="n">t</span><span class="o">**</span><span class="mi">5</span> <span class="o">*</span> <span class="n">fit2</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">9.0</span>
            <span class="c1"># Bmod pressure derivative and Gruneisen parameter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">108</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">50</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">**</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">))</span><span class="o">/</span>\
                       <span class="p">(</span><span class="mi">27</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">B0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">)</span>
            <span class="c1">#self.grun = -0.5 + self.B1/2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grun</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">grun_g_factor</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">B1</span><span class="p">)</span>

            <span class="c1"># Convert B to GPa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ev2gpa</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
                    <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
                <span class="n">ma</span><span class="p">,</span> <span class="n">mb</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">ml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span>
                <span class="c1">#print(&#39;a,b,c,lambda = &#39;,ma,mb,mc,ml)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
                <span class="n">mx0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">mb</span> <span class="o">/</span> <span class="n">mc</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sws0</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mx0</span><span class="p">)</span> <span class="o">/</span> <span class="n">ml</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsrad2vol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sws0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">=</span> <span class="n">ma</span> <span class="o">+</span> <span class="n">mb</span> <span class="o">*</span> <span class="n">mx0</span> <span class="o">+</span> <span class="n">mc</span> <span class="o">*</span> <span class="n">mx0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">mc</span> <span class="o">*</span> <span class="n">mx0</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ml</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mx0</span><span class="p">))</span>
                <span class="c1"># Convert B to GPa</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ev2gpa</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">B0</span>
                <span class="c1">#self.grun = 0.5 * ml * self.sws0</span>
                <span class="c1"># Pressure derivative of bmod</span>
                <span class="c1">#self.B1 = 2*self.grun + 1.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mx0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grun</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">grun_g_factor</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">B1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;oldpoly&#39;</span><span class="p">:</span>
                <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span>
                <span class="c1"># find minimum E in E = c0 + c1*V + c2*V**2 + c3*V**3</span>
                <span class="c1"># dE/dV = c1+ 2*c2*V + 3*c3*V**2 = 0</span>
                <span class="c1"># solve by quadratic formula with the positive root</span>

                <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">c3</span>
                <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">c2</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c1</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">sws0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="n">wsrad2vol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sws0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldpoly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span>
                <span class="c1"># Convert B to GPa</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ev2gpa</span>
                <span class="c1"># Gruneisen parameter for oldpoly not implemented</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grun</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">e0</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v0</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sws0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol2wsrad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B0</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B1</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1">#self.grun = -0.5 + self.B1 / 2.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grun</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">grun_g_factor</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">B1</span><span class="p">)</span>
                <span class="c1"># Convert B to GPa</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B0</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ev2gpa</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="EOS.compute_eos_quality"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.compute_eos_quality">[docs]</a>    <span class="k">def</span> <span class="nf">compute_eos_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute different estimates for the quality of the fit.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;sjeos&#39;</span><span class="p">:</span>
            <span class="n">sjeospredicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sjeos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="n">sjeospredicted</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">/</span> <span class="n">ss_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitted_ens</span> <span class="o">=</span> <span class="n">sjeospredicted</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_infodict</span><span class="p">[</span><span class="s1">&#39;fvec&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">/</span> <span class="n">ss_tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitted_ens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="EOS.eos_output"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.eos_output">[docs]</a>    <span class="k">def</span> <span class="nf">eos_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a string for the EOS output message.&quot;&quot;&quot;</span>

        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">timeline</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span>\
            <span class="s2">&quot; -- &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{0:02}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span>\
            <span class="s2">&quot;</span><span class="si">{0:02}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">minute</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;</span><span class="si">{0:02}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">second</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">line</span>  <span class="o">=</span> <span class="n">timeline</span> <span class="o">+</span> <span class="s2">&quot;JOBNAM = &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; -- &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Using &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">+</span> <span class="s1">&#39; function&#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Chi squared         = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Reduced Chi squared = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redchi</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;R squared           = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">+</span> <span class="s1">&#39; parameters:&#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;a      = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;b      = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;c      = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;lambda = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;sjeos&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;a = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;b = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;c = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;d = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;oldpoly&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;c0 = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;c1 = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;c2 = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;c3 = </span><span class="si">{0:16.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;E0    = </span><span class="si">{0:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Bmod  = </span><span class="si">{0:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Bmod</span><span class="se">\&#39;</span><span class="s1"> = </span><span class="si">{0:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;V0    = </span><span class="si">{0:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Ground state parameters:&#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;sws0         = </span><span class="si">{0:13.6f}</span><span class="s1"> Bohr        (WS-radius)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sws0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;V0           = </span><span class="si">{0:13.6f}</span><span class="s1"> Angstrom**3 (Volume / atom)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;E0           = </span><span class="si">{0:13.6f}</span><span class="s1"> Ry&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Bmod         = </span><span class="si">{0:13.6f}</span><span class="s1"> GPa&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;B</span><span class="se">\&#39;</span><span class="s1">           = </span><span class="si">{0:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;Grun. param. = </span><span class="si">{0:13.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grun</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;sws            Einp          Eout          Residual       &#39;</span> <span class="o">+</span>\
              <span class="s1">&#39; err (% * 10**4)&#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{0:.6f}</span><span class="s1"> </span><span class="si">{1:13.6f}</span><span class="s1"> </span><span class="si">{2:13.6f}</span><span class="s1"> </span><span class="si">{3:13.6f}</span><span class="s1"> </span><span class="si">{4:15.6f}</span><span class="se">\n</span><span class="s1">&#39;</span>\
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sws</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitted_ens</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.0E6</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="EOS.print_eos_output"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.print_eos_output">[docs]</a>    <span class="k">def</span> <span class="nf">print_eos_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_output</span><span class="p">())</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="EOS.fit"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">swses</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span><span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">show_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate volume, energy, and bulk modulus.</span>

<span class="sd">        About the units:</span>

<span class="sd">        Input &quot;swses&quot; should be the WS-radii in bohr.</span>
<span class="sd">        Input &quot;energies&quot; should be the energies in Ry.</span>

<span class="sd">        Volumes are always in Angstrom**3</span>
<span class="sd">        Bulk moduli are always in GPa</span>

<span class="sd">        :param swses: List of WS-radii</span>
<span class="sd">        :type swses: list(float)</span>
<span class="sd">        :param energies: List of energies</span>
<span class="sd">        :type energies: list(float)</span>
<span class="sd">        :param shift: Shift the energies so that the lowest energy is zero. Improves fit quality. Sometimes instable.</span>
<span class="sd">        :type shift: True or False</span>
<span class="sd">        :returns: Eq. WS-rad, energy, bulk modulus, Gruneisen parameter</span>
<span class="sd">        :rtype: float, float, float, float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">swses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsrad2vol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sws</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Remove duplicates and make sure the arrays are sorted</span>
        <span class="n">vLen0</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">uniqueInd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)[</span><span class="n">uniqueInd</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">vLen0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EOS.fit(): WARNING! Duplicate volumes have been detected.&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
                  <span class="s1">&#39;Duplicates have been removed in no particular fashion.&#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;Check the integrity of the data!&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Translate energies so that smallest value becomes zero.</span>
        <span class="c1"># An optional operation, I think sometimes it might increase</span>
        <span class="c1"># accuracy. Occasionally it also causes the fit to not converge</span>
        <span class="c1"># properly due to some divide by zero problem?</span>
        <span class="k">if</span> <span class="n">shift</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>

        <span class="c1"># Construct initial guessess for the fitting parameters of the actual fit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_initial_guess</span><span class="p">()</span>

        <span class="c1"># Now we can perform the actual fit itself:</span>
        <span class="c1"># The ground state quantities are returned.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_eos_fit</span><span class="p">()</span>

        <span class="c1"># Compute statistical error information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_eos_quality</span><span class="p">()</span>

        <span class="c1"># Printouts</span>
        <span class="k">if</span> <span class="n">show_output</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_eos_output</span><span class="p">()</span>

        <span class="c1"># Save an image for quality checking</span>
        <span class="k">if</span> <span class="n">show_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sws0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span></div>


<div class="viewcode-block" id="EOS.plot"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot fitted energy curve.</span>

<span class="sd">        Uses Matplotlib to plot the energy curve.  Use *show=True* to</span>
<span class="sd">        show the figure and *filename=&#39;abc.png&#39;* or</span>
<span class="sd">        *filename=&#39;abc.eps&#39;* to save the figure to a file.</span>

<span class="sd">        :param filename:  (Default value = None)</span>
<span class="sd">        :type filename:</span>
<span class="sd">        :param show:  (Default value = None)</span>
<span class="sd">        :type show:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#import matplotlib as mpl</span>
        <span class="c1">#mpl.use(&#39;Agg&#39;)</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">ScalarFormatter</span><span class="p">,</span> <span class="n">FormatStrFormatter</span>
        <span class="c1">#import pylab as plt</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;plot(): self.v0 is None!&#39;</span><span class="p">)</span>
            <span class="c1"># self.fit()</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;bohr&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sws</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sws</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">))(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="c1">#+ self.eMin,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;sjeos&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angstrom2bohr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">))(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="c1">#+ self.eMin,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span>
                <span class="c1">#y = self.sjeosfit0(x**-(1.0 / 3.0))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angstrom2bohr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angstrom2bohr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">))(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angstrom2bohr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2angstrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">))(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bohr2angstrom</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">))(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eMin</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],)</span>
                <span class="n">y</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ry2ev</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;energy [Ry]&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.6f</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.2</span><span class="p">,</span>
            <span class="mf">0.75</span><span class="p">,</span>
            <span class="s1">&#39;Chi^2 = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chisqr</span><span class="p">),</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.2</span><span class="p">,</span>
            <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;Red. Chi^2 = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redchi</span><span class="p">),</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.2</span><span class="p">,</span>
            <span class="mf">0.65</span><span class="p">,</span>
            <span class="s1">&#39;R^2 = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span><span class="p">),</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;bohr&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;volume [WS-radius (in Bohr)]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: E0: </span><span class="si">{1:.3f}</span><span class="s1"> Ry, w0: </span><span class="si">{2:.3f}</span><span class="s1"> Bohr, B0: </span><span class="si">{3:3.1f}</span><span class="s1"> GPa&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sws0</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B0</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;volume / atom [Angstrom^3]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: E0: </span><span class="si">{1:.3f}</span><span class="s1"> Ry, V0: </span><span class="si">{2:.3f}</span><span class="s1"> Angstrom^3, B0: </span><span class="si">{3:3.1f}</span><span class="s1"> GPa&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">e0</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B0</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="c1"># plt.tight_layout()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        <span class="c1">#if filename is not None:</span>
        <span class="c1">#    fig.savefig(&quot;fit/{0}.png&quot;.format(filename))</span>

        <span class="c1"># return f</span>

<div class="viewcode-block" id="EOS.fit_eval"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.fit_eval">[docs]</a>    <span class="k">def</span> <span class="nf">fit_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the fitting function at given points</span>

<span class="sd">        :param sws:</span>
<span class="sd">        :type sws:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span> <span class="o">==</span> <span class="s1">&#39;morse&#39;</span><span class="p">:</span>
            <span class="n">vol_arg</span> <span class="o">=</span> <span class="n">sws</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vol_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wsrad2vol</span><span class="p">(</span><span class="n">sws</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bohr2a</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eos_string</span><span class="p">))(</span>
            <span class="n">vol_arg</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eos_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],)</span>

        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="EOS.ca_fit"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.ca_fit">[docs]</a>    <span class="k">def</span> <span class="nf">ca_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">find_best_fit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fits a polynomial to x vs. y data and calculates</span>
<span class="sd">        xmin and ymin from the curve.</span>

<span class="sd">        :param x:</span>
<span class="sd">        :type x:</span>
<span class="sd">        :param y:</span>
<span class="sd">        :type y:</span>
<span class="sd">        :param n:</span>
<span class="sd">        :type n:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Basic polynomial fit whose accuracy assumes that there is no bad points:</span>
        <span class="k">if</span> <span class="n">find_best_fit</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>

        <span class="c1"># For cases where one might have outliers the following method is recommended:</span>
        <span class="k">elif</span> <span class="n">find_best_fit</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># TODO: Use asturfit to detect bad points. Currently does not work (7 points total, 1-2 bad points).</span>
            <span class="c1">#from asturfit import check_noise</span>
            <span class="c1">#x_good, y_good = check_noise(x,y,show_plot=debug)</span>
            <span class="c1">#z = np.polyfit(x_good, y_good, n)</span>
            <span class="c1">#</span>
            <span class="c1"># Detect one bad point</span>
            <span class="n">error_min</span> <span class="o">=</span> <span class="mi">9999</span>
            <span class="n">index_min</span> <span class="o">=</span> <span class="mi">9999</span>
            <span class="n">x_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_len</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">x_len</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x_len</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x_len</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">x_tmp</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">i</span><span class="p">];</span> <span class="n">x_tmp</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">y_tmp</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">i</span><span class="p">];</span> <span class="n">y_tmp</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">,</span> <span class="n">y_tmp</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
                <span class="c1"># Normalized error: length of data = x_len - 1</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_tmp</span><span class="o">-</span><span class="n">fit</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x_len</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">#print(i,x_tmp,y_tmp,error)</span>
                <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">error_min</span><span class="p">:</span>
                    <span class="n">index_min</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">error_min</span> <span class="o">=</span> <span class="n">error</span>
                    <span class="n">xmin_best</span> <span class="o">=</span> <span class="n">xmin</span>
                    <span class="n">ymin_best</span> <span class="o">=</span> <span class="n">ymin</span>
                    <span class="n">fit_best</span> <span class="o">=</span> <span class="n">fit</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin_best</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin_best</span>
            <span class="n">fit</span>  <span class="o">=</span> <span class="n">fit_best</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="c1">#import time</span>
            <span class="c1">#self.ascii_plot(x,y,fit(x),title)</span>
            <span class="c1">#time.sleep(0.1)</span>
            <span class="c1">#</span>
            <span class="kn">import</span> <span class="nn">pylab</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">100</span><span class="p">),</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">100</span><span class="p">)))</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span></div>

<div class="viewcode-block" id="EOS.relax_fit"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.relax_fit">[docs]</a>    <span class="k">def</span> <span class="nf">relax_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fits a polynomial to x vs. y data and calculates</span>
<span class="sd">        xmin and ymin from the curve.</span>

<span class="sd">        :param x:</span>
<span class="sd">        :type x:</span>
<span class="sd">        :param y:</span>
<span class="sd">        :type y:</span>
<span class="sd">        :param n:</span>
<span class="sd">        :type n:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">xmin1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xmin2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ymin1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">xmin1</span><span class="p">)</span>
            <span class="n">ymin2</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">xmin2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ymin1</span> <span class="o">&lt;</span> <span class="n">ymin2</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin1</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin2</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin2</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ascii_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">title</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1">#import pylab</span>
            <span class="c1">#pylab.plot(x,y,&#39;o&#39;)</span>
            <span class="c1">#pylab.plot(np.linspace(x[0],x[-1],100),fit(np.linspace(x[0],x[-1],100)))</span>
            <span class="c1">#pylab.plot(x_range,dfitdx,&#39;--&#39;)</span>
            <span class="c1">#pylab.show()</span>

        <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span></div>


<div class="viewcode-block" id="EOS.distortion_poly1"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.distortion_poly1">[docs]</a>    <span class="k">def</span> <span class="nf">distortion_poly1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;One variable form of the 2nd order polynomial</span>
<span class="sd">           which is used to fitting distortion vs. energy</span>
<span class="sd">           data in order to find elastic constants.</span>

<span class="sd">        :param x:</span>
<span class="sd">        :type x:</span>
<span class="sd">        :param a2:</span>
<span class="sd">        :type a2:</span>
<span class="sd">        :param a1:</span>
<span class="sd">        :type a1:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.distortion_poly2"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.distortion_poly2">[docs]</a>    <span class="k">def</span> <span class="nf">distortion_poly2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Two variable form of the 2nd order polynomial</span>
<span class="sd">           which is used to fitting distortion vs. energy</span>
<span class="sd">           data in order to find elastic constants.</span>

<span class="sd">        :param x:</span>
<span class="sd">        :type x:</span>
<span class="sd">        :param a2:</span>
<span class="sd">        :type a2:</span>
<span class="sd">        :param a0:</span>
<span class="sd">        :type a0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a0</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.distortion_poly3"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.distortion_poly3">[docs]</a>    <span class="k">def</span> <span class="nf">distortion_poly3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Three variable form of the 2nd order polynomial</span>
<span class="sd">           which is used to fitting distortion vs. energy</span>
<span class="sd">           data in order to find elastic constants.</span>

<span class="sd">        :param x:</span>
<span class="sd">        :type x:</span>
<span class="sd">        :param a2:</span>
<span class="sd">        :type a2:</span>
<span class="sd">        :param a1:</span>
<span class="sd">        :type a1:</span>
<span class="sd">        :param a0:</span>
<span class="sd">        :type a0:</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a0</span>
        <span class="k">return</span> <span class="n">E</span></div>

<div class="viewcode-block" id="EOS.distortion_fit"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.distortion_fit">[docs]</a>    <span class="k">def</span> <span class="nf">distortion_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">ascii_art</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fits the distortion_poly function to</span>
<span class="sd">        the distortion data.</span>

<span class="sd">        num : number of variables in the fitting function</span>
<span class="sd">          1 : E=a2*x**2</span>
<span class="sd">          2 : E=a2*x**2 + a0</span>
<span class="sd">          3 : E=a2*x**2 + a1*x + a0</span>

<span class="sd">        The fit coefficient(s) and r-squared describing the accuracy of the fit are returned.</span>

<span class="sd">        :param x:</span>
<span class="sd">        :type x:</span>
<span class="sd">        :param y:</span>
<span class="sd">        :type y:</span>
<span class="sd">        :param num:  (Default value = 2)</span>
<span class="sd">        :type num:</span>
<span class="sd">          :param title:  (Default value = &#39;&#39;)</span>
<span class="sd">          :type title: str</span>
<span class="sd">          :param ascii_art: True, if ascii figure of the fit should be drawn.</span>
<span class="sd">          :type ascii_art: Boolean</span>
<span class="sd">        :returns:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">y</span>

        <span class="c1"># Starting estimates for the actual fit</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # TEST: simulate symmetric high-quality 6th order polynomial fit</span>
<span class="sd">        eps = 1.0E-6</span>
<span class="sd">        zero_included = False</span>
<span class="sd">        for i in range(len(x)):</span>
<span class="sd">            if x[i]&lt;eps:</span>
<span class="sd">                zero_included = True</span>
<span class="sd">        if zero_included == True:</span>
<span class="sd">            xsim = np.zeros(2*len(x)-1)</span>
<span class="sd">            ysim = np.zeros(2*len(x)-1)</span>
<span class="sd">        else:</span>
<span class="sd">            xsim = np.zeros(2*len(x))</span>
<span class="sd">            ysim = np.zeros(2*len(x))</span>
<span class="sd">        if zero_included == True:</span>
<span class="sd">            xsim[:len(x)-1] = -x[:0:-1]</span>
<span class="sd">            xsim[len(x)-1:] = x[:]</span>
<span class="sd">            ysim[:len(x)-1] = y[:0:-1]</span>
<span class="sd">            ysim[len(x)-1:] = y[:]</span>
<span class="sd">        else:</span>
<span class="sd">            xsim[:len(x)] = -x[::-1]</span>
<span class="sd">            xsim[len(x):] = x[:]</span>
<span class="sd">            ysim[:len(x)] = y[::-1]</span>
<span class="sd">            ysim[len(x):] = y[:]</span>

<span class="sd">        print(xsim)</span>
<span class="sd">        print(ysim)</span>

<span class="sd">        print(np.polyfit(xsim,ysim,2)[-3])</span>
<span class="sd">        print(np.polyfit(xsim,ysim,3)[-3])</span>
<span class="sd">        print(np.polyfit(xsim,ysim,4)[-3])</span>
<span class="sd">        print(np.polyfit(xsim,ysim,5)[-3])</span>
<span class="sd">        print(np.polyfit(xsim,ysim,6)[-3])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

        <span class="n">popt</span><span class="p">,</span><span class="n">pcov</span><span class="p">,</span><span class="n">infodict</span><span class="p">,</span><span class="n">mesg</span><span class="p">,</span><span class="n">ier</span><span class="o">=</span><span class="n">curve_fit</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.distortion_poly</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">)),</span><span class="n">x</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">p0</span><span class="p">)</span>

        <span class="c1"># Compute error estimate for the fit</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">infodict</span><span class="p">[</span><span class="s1">&#39;fvec&#39;</span><span class="p">]</span>
        <span class="n">chisqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">redchi</span> <span class="o">=</span> <span class="n">chisqr</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">ydata</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rsquared</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">chisqr</span><span class="o">/</span><span class="n">ss_tot</span>
        <span class="c1">#fitE = self.predicted() + self.eMin</span>

        <span class="c1"># Make sure the return variable is always an array</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))):</span>
            <span class="n">popt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">popt</span><span class="p">])</span>

        <span class="c1">#print(popt)</span>

        <span class="c1"># Draw the curve</span>
        <span class="k">if</span> <span class="n">ascii_art</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">time</span>

            <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fitti</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.distortion_poly</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))(</span><span class="n">x</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">fitti</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.distortion_poly</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))(</span><span class="n">x</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">fitti</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.distortion_poly</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))(</span><span class="n">x</span><span class="p">,</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ascii_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">fitti</span><span class="p">,</span><span class="n">title</span><span class="p">)</span>

            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            # Draw simulated high-quality fit:</span>
<span class="sd">            fitti = np.poly1d(np.polyfit(xsim,ysim,6))(xsim)</span>
<span class="sd">            self.ascii_plot(xsim,ysim,fitti,title)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Allow some time to pass so that the gnuplot process finishes before</span>
            <span class="c1"># python continues. Otherwise plots might get drawn into the same canvas.</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># TEST</span>
        <span class="c1"># TEST</span>
        <span class="c1"># TEST: use symmetric fit as output</span>
        <span class="c1">#return [np.polyfit(xsim,ysim,6)[-3]],rsquared</span>
        <span class="c1"># TEST</span>
        <span class="c1"># TEST</span>

        <span class="k">return</span> <span class="n">popt</span><span class="p">,</span><span class="n">rsquared</span></div>

<div class="viewcode-block" id="EOS.ascii_plot"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.ascii_plot">[docs]</a>    <span class="k">def</span> <span class="nf">ascii_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pyemto.utilities.utils</span> <span class="k">import</span> <span class="n">run_bash</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">subprocess</span>
        <span class="kn">import</span> <span class="nn">time</span>

        <span class="n">gnuplot</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;/usr/bin/gnuplot&quot;</span><span class="p">],</span><span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

        <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set term dumb 70 20</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Adjust the legend location</span>
        <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set key left top</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">#gnuplot.stdin.write(&quot;plot &#39;-&#39; using 1:2 title &#39;{0}&#39; with lines\n&quot;.format(title))</span>
        <span class="c1">#gnuplot.stdin.write(&quot;plot &#39;-&#39; using 1:2 title &#39;fit&#39; with points\n&quot;)</span>
        <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;plot &#39;-&#39; using 1:2 title &#39;</span><span class="si">{0}</span><span class="s2">&#39; with points, &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">+</span>\
                            <span class="s2">&quot;&#39;-&#39; using 1:2 title &#39;fit&#39; with lines</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
            <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
        <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
            <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
        <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">#for i,j,k in zip(x,y,z):</span>
        <span class="c1">#    gnuplot.stdin.write(&quot;%f %f %f\n&quot; % (i,j,k))</span>
        <span class="c1">#gnuplot.stdin.write(&quot;e\n&quot;)</span>

        <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;quit&quot;</span><span class="p">)</span>
        <span class="n">gnuplot</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1"># Allow some time to pass so that the gnuplot process finishes before</span>
        <span class="c1"># python continues. Otherwise plots might get drawn into the same canvas.</span>
        <span class="c1">#time.sleep(0.1)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="EOS.polyfit"><a class="viewcode-back" href="../../EOS.html#EOS.EOS.EOS.polyfit">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="n">imag_tol</span> <span class="o">=</span> <span class="mf">1.0e-10</span>
    <span class="c1"># Perform fit using a polynomial of order n:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c1"># Find minimum x and y values:</span>
    <span class="c1"># The minima and maxima are of course the points</span>
    <span class="c1"># where the derivative has its roots:</span>
        <span class="n">der1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">der2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyder</span><span class="p">(</span><span class="n">der1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># For a minimum the second derivative must be positive.</span>
    <span class="c1"># The global minimum is the point where first derivative</span>
    <span class="c1"># is zero and the second derivative is positive and</span>
    <span class="c1"># the y value is the smallest:</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="mf">1.0e20</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">der1</span><span class="p">):</span>
        <span class="c1"># We have to be careful with imaginary roots:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">complex</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">imag_tol</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">real</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">der2</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">root</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">fit</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">y_min</span><span class="p">:</span>
                    <span class="n">y_min</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                    <span class="n">x_min</span> <span class="o">=</span> <span class="n">root</span>
        <span class="k">return</span> <span class="n">x_min</span><span class="p">,</span><span class="n">y_min</span><span class="p">,</span><span class="n">fit</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Henrik Levämäki, Matti Ropo.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.9.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>